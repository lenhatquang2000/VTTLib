VTTLib SYSTEM DEVELOPMENT LOG
=====================================
Start Date: January 13, 2026

1. AUTHENTICATION SYSTEM
-------------------------------------
- Secret login route: /topsecret/login (Route name: login).
- Controller: SecretLoginController handles Login/Logout.
- Interface: Designed with "Secret System" style (Dark mode, Glassmorphism, JetBrains Mono font).
- Default admin account (Seeder): 
    + Email: agent@vttlib.com
    + Pass: password

2. DATABASE & CONFIGURATION
--------------------------------------
- Switched connection from SQLite to MySQL (Database: vttulib).
- Performed Database Seeding for User and Metadata tables.

3. DYNAMIC METADATA MANAGEMENT
-----------------------------------------------
Flexible database model allowing unlimited metadata:
- metadata table: Defines record names (Code, Name, Description).
- metadata_values table: Stores sub-items (values) for each metadata.
- books table: Stores basic book information.
- book_metadata_value table: Many-to-Many relationship between Books and Metadata.

Completed functions:
- Controller: Admin/MetadataController.
- Admin UI: Visual management for adding/deleting Metadata and Metadata Values.
- Sidebar: Integrated Metadata menu into the Admin dashboard.

4. UI/UX
--------------------
- Header: Automatically displays "Hi, [Name]" and Logout button when logged in.
- Admin Layout: Professional Dashboard with sidebar and dynamic User info.

5. LOCALIZATION
---------------------------
- System supports switching between Vietnamese (VI) and English (EN).
- Middleware: SetLocale automatically identifies language from Session.
- Controller: LanguageController handles saving user-selected language.
- Interface: Integrated VI/EN buttons on both Client and Admin layouts.
- Translation: Managed via lang/vi.json and lang/en.json files.
- Used __() function in Blade to display content according to selected language.

6. DUAL LOGIN SYSTEM
----------------------------------------
- Client Login: /login (Route name: login). Redirects to homepage / after successful login.
- Agent Login: /topsecret/login (Route name: agent.login). Redirects to Agent Dashboard at /topsecret/dashboard after successful login.
- Agent folder structure: Moved all prefixes from /admin to /topsecret (e.g., /topsecret/dashboard, /topsecret/metadata).
- Ensured 100% of text on Login pages uses __() function for full multi-language support.

7. ROLE-BASED ACCESS CONTROL (RBAC)
------------------------------------------------
- New tables: roles (id, name, display_name) and role_user (pivot).
- Default Roles: admin, visitor.
- Middleware: EnsureHasRole (alias: role).
- Permission check:
    + Route /topsecret/*: Only allows User with admin role. Otherwise returns 403.
    + Default User agent@vttlib.com has been assigned admin role.
    + Users created via Factory are assigned visitor role by default.
- User Model: Added hasRole() method for quick permission checking.

8. BOOK DISTRIBUTION (ITEM MANAGEMENT)
------------------------------------------------
- Table: `book_items` stores physical copies of bibliographic records.
- Fields: Barcode, Accession Number, Storage Type, Location, Shelf, Status, etc.
- Multi-language Support: All labels in the distribution interface are translated using `__()`.
- Controller: `BookDistributionController` manages item creation and listing.
- UI: Two-column layout with a sleek add-item form and a data table for existing items.

9. DEPLOYMENT & DOCKER
------------------------------------------------
- Dockerfile: Multi-stage build (Composer -> Node/Vite -> Apache/PHP).
- Optimizations: Automatic configuration, route, and view caching on startup.
- .dockerignore: Excludes unnecessary files to reduce image size.

10. ROOT USER MANAGEMENT SYSTEM
------------------------------------------------
- New Route: /root/login for system administrator access.
- Root Controller: RootLoginController handles root authentication.
- Root Dashboard: /root/users for user and role management.
- Default Root Account: 
    + Email: root@vttlib.com
    + Pass: rootpassword
- Root-only Routes: Protected by role:root middleware.

11. USER CRUD OPERATIONS (COMPLETE)
------------------------------------------------
- Full CRUD Operations: Create, Read, Update, Delete users.
- Routes: 
    + GET /root/users - List users with pagination
    + POST /root/users - Create new user
    + GET /root/users/{id}/edit - Edit user form
    + PUT /root/users/{id} - Update user
    + DELETE /root/users/{id} - Delete user
- Safety Checks: Cannot delete self, cannot delete root users.
- Extended User Fields: full_name, description, job_title, status, last_login_at, last_login_ip.

12. FORMREQUEST VALIDATION SYSTEM
------------------------------------------------
- Validation Classes: 
    + StoreUserRequest - User creation validation
    + UpdateUserRequest - User update validation  
    + AssignRoleRequest - Role assignment validation
- Strong Password Policy: 8+ chars, mixed case, numbers, symbols.
- Custom Error Messages: User-friendly validation feedback.
- Controller Integration: Clean controller code with FormRequest injection.

13. SERVICE LAYER ARCHITECTURE
------------------------------------------------
- UserService: Centralized business logic for user operations.
- Database Transactions: Ensured data consistency across multiple tables.
- Exception Handling: Comprehensive try-catch with user-friendly messages.
- Dependency Injection: UserService injected into UserController.
- Activity Logging: Automatic logging of all user operations.

14. OBSERVER PATTERN IMPLEMENTATION
------------------------------------------------
- UserObserver: Automatic event handling for User model.
- Events Tracked: created, updated, deleted, restored, forceDeleted.
- Change Tracking: Logs specific field changes (old/new values).
- IP Address Logging: Records user IP for audit trail.
- AppServiceProvider: Observer registration and gate policies.

15. ACTIVITY LOGGING SYSTEM
------------------------------------------------
- ActivityLog Model: Tracks all system activities.
- Logged Data: user_id, action, model_type, model_id, details, ip_address.
- JSON Details: Flexible storage for change data and metadata.
- Automatic Logging: Observer + Service layer integration.
- Audit Trail: Complete history of user management operations.

16. ENHANCED SECURITY FEATURES
------------------------------------------------
- Password Strength Validation: Enforced strong password requirements.
- Role-based Access Control: Three-tier system (root/admin/visitor).
- CSRF Protection: Laravel built-in CSRF tokens.
- SQL Injection Prevention: Eloquent ORM usage.
- Input Sanitization: FormRequest validation with custom rules.

17. CODE QUALITY IMPROVEMENTS
------------------------------------------------
- Clean Architecture: Service-Repository Pattern implementation.
- PSR Standards: Code follows PSR-12 formatting conventions.
- PHP Documentation: Comprehensive DocBlocks for all classes.
- Error Handling: Graceful exception handling with user feedback.
- Separation of Concerns: Business logic separated from presentation.

18. UI/UX ENHANCEMENTS
------------------------------------------------
- Edit User Form: Professional user editing interface.
- Dynamic Tables: Enhanced user listing with search/filter.
- Modal Forms: Create user with real-time validation feedback.
- Confirmation Dialogs: Safety confirmations for destructive actions.
- Flash Messages: Clear success/error notifications.

19. CIRCULATION SYSTEM (CHÍNH SÁCH LƯU THÔNG)
------------------------------------------------
- Database Tables:
    + patron_groups: Nhóm độc giả (Sinh viên, Giảng viên, Khách)
    + circulation_policies: Chính sách mượn/trả theo nhóm
    + loan_transactions: Giao dịch mượn/trả sách
    + fines: Quản lý phạt quá hạn
    + reservations: Đặt trước sách
- Models: PatronGroup, CirculationPolicy, LoanTransaction, Fine, Reservation
- Controller: CirculationController với đầy đủ CRUD operations
- Routes: 14 routes cho circulation management
- Views: 
    + /topsecret/circulation - Quản lý chính sách
    + /topsecret/circulation/loan-desk - Quầy mượn/trả
    + /topsecret/circulation/fines - Quản lý phạt
- Features:
    + Checkout/Checkin books with barcode scanning
    + Auto-calculate overdue fines
    + Loan renewal with limits
    + Fine payment and waiver
    + Policy-based loan rules per patron group
    + Constraint checks (max items, outstanding fines)

